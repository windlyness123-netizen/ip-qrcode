<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IPå½’å±åœ°æŸ¥è¯¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            max-width: 500px;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            color: #333;
        }
        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 30px;
            color: #4a4a4a;
        }
        .ip-address {
            font-size: 32px;
            font-weight: bold;
            background: #f0f0f0;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            letter-spacing: 1px;
            word-break: break-all;
        }
        .location {
            font-size: 28px;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            border-radius: 12px;
        }
        .nj {
            background: #4CAF50;
            color: white;
        }
        .not-nj {
            background: #f44336;
            color: white;
        }
        .detail {
            font-size: 18px;
            color: #666;
            margin-top: 20px;
        }
        .loading {
            font-size: 18px;
            color: #999;
        }
        .footer {
            margin-top: 30px;
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }
        .error-detail {
            font-size: 14px;
            color: #999;
            margin-top: 10px;
        }
        .contact-info {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 12px;
            margin-top: 30px;
            font-size: 16px;
            text-align: center;
        }
        .contact-info a {
            color: #856404;
            font-weight: bold;
            text-decoration: underline;
        }
        .contact-info .phone {
            font-size: 22px;
            font-weight: bold;
            letter-spacing: 1px;
        }
        /* æ–°å¢è¾“å…¥æ¡†æ ·å¼ */
        .input-area {
            margin: 20px 0 10px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        #ipInput {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 30px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }
        #ipInput:focus {
            border-color: #667eea;
        }
        #queryBtn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
            white-space: nowrap;
        }
        #queryBtn:hover {
            background: #5a67d8;
        }
        #queryBtn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .note {
            font-size: 14px;
            color: #999;
            margin-bottom: 20px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">ğŸ“ IPå½’å±åœ°æŸ¥è¯¢</div>

        <!-- æ–°å¢è‡ªå®šä¹‰IPè¾“å…¥æ¡† -->
        <div class="input-area">
            <input type="text" id="ipInput" placeholder="è¾“å…¥IPåœ°å€ï¼ˆå¦‚ 8.8.8.8ï¼‰" value="">
            <button id="queryBtn" onclick="handleManualQuery()">æŸ¥è¯¢</button>
        </div>
        <div class="note">æç¤ºï¼šè¾“å…¥IPåç‚¹å‡»æŸ¥è¯¢ï¼Œå°†æ˜¾ç¤ºè¯¥IPçš„å½’å±åœ°ã€‚é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ˜¾ç¤ºå½“å‰è®¾å¤‡IPã€‚</div>

        <div id="ipDisplay" class="loading">æ­£åœ¨è·å–IPä¿¡æ¯...</div>
        <div id="errorDetail" class="error-detail"></div>

        <div class="contact-info">
            <div style="font-size: 18px; margin-bottom: 8px;">ğŸ“¸ åŠŸèƒ½æ­£å¸¸äº†ï¼Ÿæˆªå›¾æœ¬é¡µé¢è”ç³»åœ¨çº¿å®¢æœ</div>
            <div>æ²¡å›å¤è¯·è‡´ç”µ <span class="phone">18761662888</span></div>
        </div>
    </div>
    <div class="footer">æ‰«ç å³æŸ¥ Â· å®æ—¶æ›´æ–°</div>

    <script>
        function showError(msg) {
            document.getElementById('errorDetail').innerText = 'é”™è¯¯ï¼š' + msg;
        }

        // é€šç”¨çš„IPæŸ¥è¯¢å‡½æ•°
        async function queryIP(ip) {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('ipDisplay').innerHTML = '<div class="loading">æ­£åœ¨æŸ¥è¯¢...</div>';
            document.getElementById('errorDetail').innerText = '';

            let location = 'æœªçŸ¥';
            let city = '', region = '', country = '';

            // ä¼˜å…ˆä½¿ç”¨ ipapi.co
            const geoAPIs = [
                { url: (ip) => `https://ipapi.co/${ip}/json/`, format: 'ipapi' },
                { url: (ip) => `https://ip.sb/geoip/${ip}`, format: 'ip.sb' },
                { url: (ip) => `https://ipwho.is/${ip}`, format: 'ipwhois' }
            ];

            function extractLocation(data, format) {
                if (format === 'ipapi') {
                    return {
                        city: data.city || '',
                        region: data.region || '',
                        country: data.country_name || ''
                    };
                } else if (format === 'ip.sb') {
                    return {
                        city: data.city || '',
                        region: data.region || '',
                        country: data.country || ''
                    };
                } else if (format === 'ipwhois') {
                    return {
                        city: data.city || '',
                        region: data.region || '',
                        country: data.country || ''
                    };
                }
                return { city: '', region: '', country: '' };
            }

            for (let geo of geoAPIs) {
                try {
                    const url = geo.url(ip);
                    const res = await fetch(url, { timeout: 5000 });
                    if (!res.ok) continue;
                    const data = await res.json();
                    const extracted = extractLocation(data, geo.format);
                    if (extracted.country || extracted.city) {
                        city = extracted.city;
                        region = extracted.region;
                        country = extracted.country;
                        location = (region + ' ' + city).trim() || country;
                        break;
                    }
                } catch (e) {
                    console.warn('Geo API å¤±è´¥:', geo.format, e);
                }
            }

            // åˆ¤æ–­æ˜¯å¦åŒ…å«â€œå—äº¬â€
            const isNanjing = location.includes('å—äº¬');

            document.getElementById('ipDisplay').innerHTML = `
                <div class="ip-address">${ip}</div>
                <div class="location ${isNanjing ? 'nj' : 'not-nj'}">
                    ${location}
                </div>
                <div class="detail">
                    ${isNanjing ? 'âœ… å—äº¬IP' : 'âŒ éå—äº¬IP'}
                </div>
            `;
        }

        // è·å–å½“å‰è®¾å¤‡IPï¼ˆè‡ªåŠ¨æ‰§è¡Œï¼‰
        async function getCurrentIP() {
            const ipAPIs = [
                'https://api.ipify.org?format=json',
                'https://api.my-ip.io/ip.json',
                'https://ipapi.co/json/'
            ];

            let ip = null;
            for (let api of ipAPIs) {
                try {
                    const res = await fetch(api, { timeout: 5000 });
                    if (!res.ok) continue;
                    const data = await res.json();
                    ip = data.ip || data.ip_address;
                    if (ip) break;
                } catch (e) {
                    console.warn('IP API å¤±è´¥:', api, e);
                }
            }

            if (!ip) {
                document.getElementById('ipDisplay').innerHTML = '<div class="ip-address">è·å–å¤±è´¥</div><div class="detail">æ— æ³•è·å–IPåœ°å€ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ</div>';
                showError('æ‰€æœ‰IP APIå‡å¤±è´¥');
                return;
            }

            // æŸ¥è¯¢è¯¥IPçš„å½’å±åœ°
            await queryIP(ip);
        }

        // å¤„ç†æ‰‹åŠ¨æŸ¥è¯¢
        async function handleManualQuery() {
            const input = document.getElementById('ipInput').value.trim();
            if (!input) {
                showError('è¯·è¾“å…¥IPåœ°å€');
                return;
            }
            // ç®€å•éªŒè¯IPæ ¼å¼ï¼ˆå¯é€‰ï¼‰
            const ipPattern = /^(\d{1,3}\.){3}\d{1,3}$/;
            if (!ipPattern.test(input)) {
                showError('IPåœ°å€æ ¼å¼ä¸æ­£ç¡®');
                return;
            }
            await queryIP(input);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–å½“å‰IP
        getCurrentIP().catch(e => {
            document.getElementById('ipDisplay').innerHTML = '<div class="ip-address">è·å–å¤±è´¥</div><div class="detail">è¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•</div>';
            showError(e.message);
        });
    </script>
</body>
</html>
