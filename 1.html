<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IPå½’å±åœ°æŸ¥è¯¢</title>
    <style>
        /* æ ·å¼ä¸ä¹‹å‰å®Œå…¨ç›¸åŒï¼Œæ­¤å¤„çœç•¥èŠ‚çœç¯‡å¹…ï¼Œè¯·ç›´æ¥å¤åˆ¶ä¸Šä¸€ç‰ˆçš„å®Œæ•´æ ·å¼ */
        body { ... }
        .container { ... }
        .title { ... }
        .ip-address { ... }
        .location { ... }
        .nj { ... }
        .not-nj { ... }
        .detail { ... }
        .loading { ... }
        .footer { ... }
        .error-detail { ... }
        .contact-info { ... }
        .contact-info .phone { ... }
        .input-area { ... }
        #ipInput { ... }
        #queryBtn { ... }
        .note { ... }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">ğŸ“ IPå½’å±åœ°æŸ¥è¯¢</div>
        <div class="input-area">
            <input type="text" id="ipInput" placeholder="è¾“å…¥IPåœ°å€ï¼ˆå¦‚ 8.8.8.8ï¼‰" value="">
            <button id="queryBtn" onclick="handleManualQuery()">æŸ¥è¯¢</button>
        </div>
        <div class="note">æç¤ºï¼šè¾“å…¥IPåç‚¹å‡»æŸ¥è¯¢ï¼Œå°†æ˜¾ç¤ºè¯¥IPçš„å½’å±åœ°ã€‚é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ˜¾ç¤ºå½“å‰è®¾å¤‡IPã€‚</div>
        <div id="ipDisplay" class="loading">æ­£åœ¨è·å–IPä¿¡æ¯...</div>
        <div id="errorDetail" class="error-detail"></div>
        <div class="contact-info">
            <div style="font-size: 18px; margin-bottom: 8px;">ğŸ“¸ åŠŸèƒ½æ­£å¸¸äº†ï¼Ÿæˆªå›¾æœ¬é¡µé¢è”ç³»åœ¨çº¿å®¢æœ</div>
            <div>æ²¡å›å¤è¯·è‡´ç”µ <span class="phone">18761662888</span></div>
        </div>
    </div>
    <div class="footer">æ‰«ç å³æŸ¥ Â· å®æ—¶æ›´æ–°</div>

    <script>
        // è¯·æ›¿æ¢ä¸ºæ‚¨çš„ç™¾åº¦åœ°å›¾ API Key
        const BAIDU_AK = 'YOUR_BAIDU_AK'; // <-- åœ¨è¿™é‡Œå¡«å…¥ä½ çš„ak

        function showError(msg) {
            document.getElementById('errorDetail').innerText = 'é”™è¯¯ï¼š' + msg;
        }

        // 1. ç™¾åº¦åœ°å›¾ IP å®šä½ APIï¼ˆä¼˜å…ˆä½¿ç”¨ï¼‰
        async function queryBaiduMap(ip) {
            if (!BAIDU_AK || BAIDU_AK === 'YOUR_BAIDU_AK') {
                console.warn('æœªé…ç½®ç™¾åº¦åœ°å›¾AKï¼Œè·³è¿‡');
                return null;
            }
            try {
                const url = `https://api.map.baidu.com/location/ip?ak=${BAIDU_AK}&ip=${ip}&coor=bd09ll`;
                const res = await fetch(url, { timeout: 5000 });
                if (!res.ok) return null;
                const data = await res.json();
                if (data.status === 0 && data.content && data.content.address_detail) {
                    const addr = data.content.address_detail;
                    return {
                        country: 'ä¸­å›½',
                        region: addr.province || '',
                        city: addr.city || ''
                    };
                }
                return null;
            } catch (e) {
                console.warn('ç™¾åº¦åœ°å›¾APIè¯·æ±‚å¤±è´¥', e);
                return null;
            }
        }

        // 2. å¤‡ç”¨ APIï¼šipapi.co
        async function queryIpapiCo(ip) {
            try {
                const url = `https://ipapi.co/${ip}/json/?lang=zh-cn`;
                const res = await fetch(url, { timeout: 5000 });
                if (!res.ok) return null;
                const data = await res.json();
                if (data.error) return null;
                return {
                    country: data.country_name || '',
                    region: data.region || '',
                    city: data.city || ''
                };
            } catch (e) {
                console.warn('ipapi.co å¤±è´¥', e);
                return null;
            }
        }

        // 3. å¤‡ç”¨ APIï¼šip.sb
        async function queryIpSb(ip) {
            try {
                const url = `https://ip.sb/geoip/${ip}`;
                const res = await fetch(url, {
                    timeout: 5000,
                    headers: { 'Accept-Language': 'zh-CN,zh;q=0.9' }
                });
                if (!res.ok) return null;
                const data = await res.json();
                return {
                    country: data.country || '',
                    region: data.region || '',
                    city: data.city || ''
                };
            } catch (e) {
                console.warn('ip.sb å¤±è´¥', e);
                return null;
            }
        }

        // é€šç”¨æŸ¥è¯¢å‡½æ•°
        async function queryIP(ip) {
            document.getElementById('ipDisplay').innerHTML = '<div class="loading">æ­£åœ¨æŸ¥è¯¢...</div>';
            document.getElementById('errorDetail').innerText = '';

            let location = 'æœªçŸ¥';
            let city = '', region = '', country = '';

            // å°è¯•ç™¾åº¦åœ°å›¾
            const baiduResult = await queryBaiduMap(ip);
            if (baiduResult) {
                city = baiduResult.city;
                region = baiduResult.region;
                country = baiduResult.country;
                location = (region + ' ' + city).trim() || country;
            } else {
                // å°è¯• ipapi.co
                const ipapiResult = await queryIpapiCo(ip);
                if (ipapiResult) {
                    city = ipapiResult.city;
                    region = ipapiResult.region;
                    country = ipapiResult.country;
                    location = (region + ' ' + city).trim() || country;
                } else {
                    // å°è¯• ip.sb
                    const sbResult = await queryIpSb(ip);
                    if (sbResult) {
                        city = sbResult.city;
                        region = sbResult.region;
                        country = sbResult.country;
                        location = (region + ' ' + city).trim() || country;
                    } else {
                        // æœ€åå°è¯• ipwho.is
                        try {
                            const url = `https://ipwho.is/${ip}`;
                            const res = await fetch(url, { timeout: 5000 });
                            if (res.ok) {
                                const data = await res.json();
                                if (data.success) {
                                    city = data.city || '';
                                    region = data.region || '';
                                    country = data.country || '';
                                    location = (region + ' ' + city).trim() || country;
                                }
                            }
                        } catch (e) {
                            console.warn('æ‰€æœ‰APIå‡å¤±è´¥', e);
                        }
                    }
                }
            }

            // åˆ¤æ–­æ˜¯å¦åŒ…å«â€œå—äº¬â€
            const isNanjing = location.includes('å—äº¬');
            document.getElementById('ipDisplay').innerHTML = `
                <div class="ip-address">${ip}</div>
                <div class="location ${isNanjing ? 'nj' : 'not-nj'}">
                    ${location}
                </div>
                <div class="detail">
                    ${isNanjing ? 'âœ… å—äº¬IP' : 'âŒ éå—äº¬IP'}
                </div>
            `;
        }

        // è·å–å½“å‰è®¾å¤‡IP
        async function getCurrentIP() {
            const ipAPIs = [
                'https://api.ipify.org?format=json',
                'https://api.my-ip.io/ip.json',
                'https://ipapi.co/json/'
            ];
            let ip = null;
            for (let api of ipAPIs) {
                try {
                    const res = await fetch(api, { timeout: 5000 });
                    if (!res.ok) continue;
                    const data = await res.json();
                    ip = data.ip || data.ip_address;
                    if (ip) break;
                } catch (e) {
                    console.warn('IP API å¤±è´¥:', api, e);
                }
            }
            if (!ip) {
                document.getElementById('ipDisplay').innerHTML = '<div class="ip-address">è·å–å¤±è´¥</div><div class="detail">æ— æ³•è·å–IPåœ°å€ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ</div>';
                showError('æ‰€æœ‰IP APIå‡å¤±è´¥');
                return;
            }
            await queryIP(ip);
        }

        async function handleManualQuery() {
            const input = document.getElementById('ipInput').value.trim();
            if (!input) return showError('è¯·è¾“å…¥IPåœ°å€');
            if (!/^(\d{1,3}\.){3}\d{1,3}$/.test(input)) return showError('IPæ ¼å¼ä¸æ­£ç¡®');
            await queryIP(input);
        }

        getCurrentIP().catch(e => {
            document.getElementById('ipDisplay').innerHTML = '<div class="ip-address">è·å–å¤±è´¥</div><div class="detail">è¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•</div>';
            showError(e.message);
        });
    </script>
</body>
</html>
