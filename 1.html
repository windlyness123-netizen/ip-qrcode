<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IPå½’å±åœ°æŸ¥è¯¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            max-width: 500px;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            color: #333;
        }
        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 30px;
            color: #4a4a4a;
        }
        .ip-address {
            font-size: 32px;
            font-weight: bold;
            background: #f0f0f0;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            letter-spacing: 1px;
            word-break: break-all;
        }
        .location {
            font-size: 28px;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            border-radius: 12px;
        }
        .nj {
            background: #4CAF50;
            color: white;
        }
        .not-nj {
            background: #f44336;
            color: white;
        }
        .detail {
            font-size: 18px;
            color: #666;
            margin-top: 20px;
        }
        .loading {
            font-size: 18px;
            color: #999;
        }
        .footer {
            margin-top: 30px;
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }
        .error-detail {
            font-size: 14px;
            color: #999;
            margin-top: 10px;
        }
        /* æ–°å¢å®¢æœä¿¡æ¯æ ·å¼ */
        .contact-info {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 12px;
            margin-top: 30px;
            font-size: 16px;
            text-align: center;
        }
        .contact-info a {
            color: #856404;
            font-weight: bold;
            text-decoration: underline;
        }
        .contact-info .phone {
            font-size: 22px;
            font-weight: bold;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">ğŸ“ IPå½’å±åœ°æŸ¥è¯¢</div>
        <div id="ipDisplay" class="loading">æ­£åœ¨è·å–IPä¿¡æ¯...</div>
        <div id="errorDetail" class="error-detail"></div>

        <!-- æ–°å¢å®¢æœè”ç³»ä¿¡æ¯ -->
        <div class="contact-info">
            <div style="font-size: 18px; margin-bottom: 8px;">ğŸ“¸æˆªå›¾æœ¬é¡µé¢è”ç³»åœ¨çº¿å®¢æœ</div>
            <div>æ²¡å›å¤è¯·è‡´ç”µ <span class="phone">18761662888</span></div>
        </div>
    </div>
    <div class="footer">æ‰«ç å³æŸ¥ Â· å®æ—¶æ›´æ–°</div>

    <script>
        // æ˜¾ç¤ºé”™è¯¯è¯¦æƒ…ï¼ˆç”¨äºè°ƒè¯•ï¼‰
        function showError(msg) {
            document.getElementById('errorDetail').innerText = 'é”™è¯¯ï¼š' + msg;
        }

        // è·å–IPçš„APIåˆ—è¡¨ï¼ˆæŒ‰é¡ºåºå°è¯•ï¼‰
        const ipAPIs = [
            'https://api.ipify.org?format=json',
            'https://api.my-ip.io/ip.json',  // å¤‡ç”¨1
            'https://ipapi.co/json/'          // å¤‡ç”¨2
        ];

        // è·å–åœ°ç†ä½ç½®çš„APIåˆ—è¡¨ï¼ˆå¯¹åº”ä¸åŒçš„æ•°æ®æ ¼å¼ï¼‰
        const geoAPIs = [
            { url: (ip) => `https://ip.sb/geoip/${ip}`, format: 'ip.sb' },
            { url: (ip) => `https://ipapi.co/${ip}/json/`, format: 'ipapi' },
            { url: (ip) => `https://ipwho.is/${ip}`, format: 'ipwhois' }
        ];

        // ä»ä¸åŒæ ¼å¼çš„å“åº”ä¸­æå–åŸå¸‚/çœä»½
        function extractLocation(data, format) {
            if (format === 'ip.sb') {
                return {
                    city: data.city || '',
                    region: data.region || '',
                    country: data.country || ''
                };
            } else if (format === 'ipapi') {
                return {
                    city: data.city || '',
                    region: data.region || '',
                    country: data.country_name || ''
                };
            } else if (format === 'ipwhois') {
                return {
                    city: data.city || '',
                    region: data.region || '',
                    country: data.country || ''
                };
            }
            return { city: '', region: '', country: '' };
        }

        async function getIPInfo() {
            let ip = null;
            // 1. å°è¯•è·å–IP
            for (let api of ipAPIs) {
                try {
                    const res = await fetch(api, { timeout: 5000 });
                    if (!res.ok) continue;
                    const data = await res.json();
                    ip = data.ip || data.ip_address; // å…¼å®¹ä¸åŒè¿”å›æ ¼å¼
                    if (ip) break;
                } catch (e) {
                    console.warn('IP API å¤±è´¥:', api, e);
                }
            }

            if (!ip) {
                document.getElementById('ipDisplay').innerHTML = '<div class="ip-address">è·å–å¤±è´¥</div><div class="detail">æ— æ³•è·å–IPåœ°å€ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ</div>';
                showError('æ‰€æœ‰IP APIå‡å¤±è´¥');
                return;
            }

            // 2. å°è¯•è·å–åœ°ç†ä½ç½®
            let location = 'æœªçŸ¥';
            let city = '', region = '', country = '';
            for (let geo of geoAPIs) {
                try {
                    const url = geo.url(ip);
                    const res = await fetch(url, { timeout: 5000 });
                    if (!res.ok) continue;
                    const data = await res.json();
                    const extracted = extractLocation(data, geo.format);
                    if (extracted.country || extracted.city) {
                        city = extracted.city;
                        region = extracted.region;
                        country = extracted.country;
                        location = (region + ' ' + city).trim() || country;
                        break;
                    }
                } catch (e) {
                    console.warn('Geo API å¤±è´¥:', geo.format, e);
                }
            }

            // 3. åˆ¤æ–­æ˜¯å¦å—äº¬
            const isNanjing = location.includes('å—äº¬');

            // 4. æ›´æ–°æ˜¾ç¤º
            document.getElementById('ipDisplay').innerHTML = `
                <div class="ip-address">${ip}</div>
                <div class="location ${isNanjing ? 'nj' : 'not-nj'}">
                    ${location}
                </div>
                <div class="detail">
                    ${isNanjing ? 'âœ… å—äº¬IP' : 'âŒ éæ±Ÿè‹å—äº¬IP'}
                </div>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        getIPInfo().catch(e => {
            document.getElementById('ipDisplay').innerHTML = '<div class="ip-address">è·å–å¤±è´¥</div><div class="detail">è¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•</div>';
            showError(e.message);
        });
    </script>
</body>
</html>
